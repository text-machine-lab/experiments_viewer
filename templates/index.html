%from datetime import timedelta
% rebase('templates/base.html', title='Home')
<h1>Experiments</h1>

<div class="u-full-width">
    Toggle columns:
    <ul class="columns-list">
        % for cv in config_values:
        <li><a data-column="{{ cv }}" class="toggle-column" href="#">{{ cv.replace('_',' ') }}</a></li>
        % end
    </ul>
</div>

<table id="experiments" class="u-full-width">
    <thead>
    <tr>
        <th>Model</th>
        <th>Start time</th>
        <th>Duration</th>

        % for cv in config_values:
        <th data-name="{{ cv }}" data-visible="false">{{ cv.replace('_',' ') }}</th>
        % end

        <th>Train Score</th>
        <th>Train Precision</th>
        <th>Train Recall</th>
        <th>Train AUC</th>

        <th>Val Score</th>
        <th>Val Precision</th>
        <th>Val Recall</th>
        <th data-name="auc_val">Val AUC</th>
    </tr>
    </thead>
    <tbody>

    % for exp in experiments_info:
    <tr>
        <td>{{ exp['model'] }}</td>
        <td>{{ exp['start_time'].strftime('%x %X') }}</td>
        <td>{{ timedelta(seconds=int((exp['stop_time'] - exp['start_time']).total_seconds())) }}</td>

        % for cv in config_values:
        <td>{{ exp['config'].get(cv,'') }}</td>
        % end


        <td>{{ '{0:0.3f}'.format(exp['result']['score_train']) }}</td>
        <td>{{ '{0:0.3f}'.format(exp['result']['precision_train']) }}</td>
        <td>{{ '{0:0.3f}'.format(exp['result']['recall_train']) }}</td>
        <td>{{ '{0:0.3f}'.format(exp['result']['auc_train']) }}</td>

        <td>{{ '{0:0.3f}'.format(exp['result']['score_val']) }}</td>
        <td>{{ '{0:0.3f}'.format(exp['result']['precision_val']) }}</td>
        <td>{{ '{0:0.3f}'.format(exp['result']['recall_val']) }}</td>
        <td>{{ '{0:0.3f}'.format(exp['result']['auc_val']) }}</td>
    </tr>
    % end

    </tbody>
</table>

<script>
    $(function () {
        var table = $('#experiments').DataTable({
            "info": false,
            "paging": false,
            "searching": false,
            order: [[$("[data-name='auc_val']").index(),'desc']]
        });

        $('a.toggle-column').on('click', function (e) {
            e.preventDefault();

            // Get the column API object
            var column = table.column($(this).attr('data-column') + ':name');

            // Toggle the visibility
            column.visible(!column.visible());
        });
    });
</script>